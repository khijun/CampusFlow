<!DOCTYPE html>
<!-- 관리자용 수강신청 관리 페이지 -->
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>수강신청 관리</title>
    <!-- 테이블 스타일 -->
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .btn {
            padding: 5px 10px;
            margin: 0 2px;
            cursor: pointer;
            border: none;
            border-radius: 3px;
        }
        .approve-btn {
            background-color: #4CAF50;
            color: white;
        }
        .reject-btn {
            background-color: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <!-- 페이지 제목 -->
    <h2>수강신청 관리</h2>
    
    <!-- 수강신청 관리 테이블 -->
    <table>
        <!-- 테이블 헤더 -->
        <thead>
            <tr>
                <th>강의명</th>
                <th>학번</th>
                <th>학생명</th>
                <th>학과</th>
                <th>이수구분</th>
                <th>학점</th>
                <th>강의시간</th>
                <th>강의실</th>
                <th>신청상태</th>
                <th>관리</th>
            </tr>
        </thead>
        <!-- 테이블 본문: 수강신청 목록 -->
        <tbody>
            <tr th:each="reg : ${registrations}">
                <td th:text="${reg.lectureName}"></td>
                <td th:text="${reg.memberId}"></td>
                <td th:text="${reg.name}"></td>
                <td th:text="${reg.deptName}"></td>
                <td th:text="${reg.subjectType}"></td>
                <td th:text="${reg.subjectCredits}"></td>
                <td th:text="${reg.lectureDay + ' ' + reg.startTime + '-' + reg.endTime}"></td>
                <td th:text="${reg.facilityName}"></td>
                <td th:text="${reg.regStatus}"></td>
                <td>
                    <!-- 승인/거절 버튼 -->
                    <button class="btn approve-btn" 
                            th:onclick="'updateStatus(' + ${reg.lectureId} + ', \'' + ${reg.memberId} + '\', \'APPROVED\')'">
                        승인
                    </button>
                    <button class="btn reject-btn" 
                            th:onclick="'updateStatus(' + ${reg.lectureId} + ', \'' + ${reg.memberId} + '\', \'REJECTED\')'">
                        거절
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- JavaScript 함수 -->
    <script>
        // 수강신청 상태 업데이트 함수
        function updateStatus(lectureId, memberId, status) {
            if (!confirm(status === 'APPROVED' ? '승인하시겠습니까?' : '거절하시겠습니까?')) {
                return;
            }

            const data = {
                lectureId: lectureId,
                memberId: memberId,
                regStatus: status
            };

            fetch('/iframe/ofregistration/admin/update-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    alert(status === 'APPROVED' ? '승인되었습니다.' : '거절되었습니다.');
                    location.reload();
                } else {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
            })
            .catch(error => {
                alert('처리 실패: ' + error.message);
            });
        }
    </script>
</body>
</html>