<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>학사관리 시스템</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="css/main/header.css" rel="stylesheet">
    <link href="css/main/navigation.css" rel="stylesheet">
    <link href="css/main/sidebar.css" rel="stylesheet">
    <link href="css/main/main-content.css" rel="stylesheet">
    <link href="css/main/tab.css" rel="stylesheet">
    <link href="css/main/mainStyle.css" rel="stylesheet">
    <link href="css/main/sidebar-menu.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <!-- Header -->
    <nav class="header-nav">
        <div class="header-left">
            <div class="header-logo">
                <img alt="두인대학교 로고" src="/assets/logo/doinUniver_02.png">
            </div>
            <div class="header-title">
                두인대학교
                <small>DOIN UNIVERSITY 통합정보시스템</small>
            </div>
        </div>

        <ul class="header-list">
            <li class="header-member-info-li" th:if="${memberDTO != null}">
                <span id="session-timer" th:text="'남은 시간: ' + ${remainingTime}">남은 시간</span>
                <button class="session-button" id="session-extension-btn">세션 연장</button>
                <span th:text="${memberDTO.deptName}">학과</span>
                <span th:text="|${memberDTO.memberId}(${memberDTO.memberTypeStr})|">학번(멤버 타입)</span>
                <span th:text="${memberDTO.name}">박 두 인</span>
            </li>
            <li>
                <a class="logout-link" href="#" onclick="handleLogout()" th:if="${memberDTO != null}">로그아웃</a>
                <a th:href="@{/login}" th:if="${memberDTO == null}">로그인</a>
            </li>
        </ul>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="side-bar">
        <div class="sidebar-header">
            <h2>학 사</h2>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Tab Container -->
        <div class="tab-container">
            <ul id="tabs" class="draggable-tabs"></ul>
            <div class="tab-controls">
                <button class="close-all" onclick="closeAllTabs()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>

        <!-- Iframe Container -->
        <div class="iframe-container" style="display: none;">
            <!-- iframe은 JavaScript에서 동적으로 생성됩니다 -->
        </div>

        <!-- 메인 컨텐츠 iframe -->
        <iframe id="main-content-frame" src="/main-content" style="width: 100%; height: calc(100vh - 140px); border: none; display: block;">
        </iframe>
    </div>
</div>
<script src="/js/tab.js"></script> <!-- 경로를 /static/js/ 대신 /js/로 수정 -->
<script src="/js/session_timer.js"></script>
<script src="/js/sidebar_category.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 세션 스토리지 초기화
        sessionStorage.removeItem('tabState');

        // iframe 컨테이너 초기화
        const iframeContainer = document.querySelector('.iframe-container');
        if (iframeContainer) {
            iframeContainer.innerHTML = '';
            iframeContainer.style.display = 'none';
        }

        // 메인 컨텐츠 표시
        const mainContent = document.querySelector('.info-container');
        if (mainContent) {
            mainContent.style.display = 'flex';
        }

        // 메인 탭만 추가
        const tabs = document.getElementById('tabs');
        if (tabs) {
            tabs.innerHTML = ''; // 기존 탭 모두 제거
            addTab('메인', '/main', false); // 메인 탭 추가
        }

        // 메인 탭 활성화
        switchTab('/main');
    });

    function handleLogout() {
        clearTabState();
        window.location.href = '/logout';
    }
</script>
</body>
</html>
